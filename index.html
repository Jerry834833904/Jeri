<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ATW串焊机4级解锁</title>
  <style>
    :root{
      --bg:#f5f5f7; --ink:#111; --muted:#8e8e93; --card:#fff;
      --border:#e5e5ea; --btnbg:#e9e9ec; --highlight:#16a34a;
    }
    html,body{height:100%;}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font:17px/1.7 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang SC","Microsoft YaHei",sans-serif;
    }
    .wrap{ min-height:100%; display:flex; flex-direction:column; align-items:center; padding: env(safe-area-inset-top) 20px 40px; }
    .topbar{
      width:100%; max-width:640px; display:flex; align-items:center; justify-content:space-between; margin-top:10px;
    }
    .datetime{ font-size:18px; font-weight:600; letter-spacing:.5px; }
    .luggage{
      border:1px solid var(--border); background:var(--card); border-radius:10px; padding:6px 12px; cursor:pointer; font-size:14px;
    }
    .card{
      width:100%; max-width:640px; background:var(--card); border:1px solid var(--border);
      border-radius:20px; margin-top:20px; padding:28px 20px 24px; text-align:center;
      box-shadow: 0 6px 24px rgba(0,0,0,.05);
    }
    h1{ margin:0 0 18px; font-size:22px; font-weight:800; }
    .input{ margin:14px auto 12px; width:min(420px,100%); }
    input[type="text"]{
      width:100%; font-size:16px; padding:12px 12px; border-radius:12px;
      border:1px solid var(--border); background:#fafafa; outline:none; text-align:center;
    }
    input::placeholder{ color:#b0b0b4; }
    .btn{
      width:min(420px,100%); padding:12px; margin:10px auto 0; border-radius:12px;
      border:1px solid #d0d0d4; background:var(--btnbg); font-weight:700; cursor:pointer; font-size:15px;
    }
    .res{ margin-top:18px; font-size:24px; font-weight:700; color:var(--highlight); min-height:1.4em; }
    .err{ color:#e64545; font-size:14px; min-height:1.2em; }
    .footer{ max-width:640px; color:#9a9aa0; font-size:13px; text-align:center; margin-top:28px; }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- 顶部：时间 + 语言切换 -->
    <div class="topbar">
      <div class="datetime" id="now">--/--/-- --:--:--</div>
      <button class="luggage" id="luggageBtn">🧳 Luggage</button>
    </div>

    <!-- 主卡片 -->
    <div class="card">
      <h1 id="title">ATW串焊机4级解锁</h1>
      <div class="input">
        <input id="sn" type="text" inputmode="numeric" maxlength="5" pattern="\d{5}" placeholder="请输入5位序列号" />
      </div>
      <button class="btn" id="genBtn">生成密码</button>
      <div class="err" id="err"></div>
      <div class="res" id="res"></div>
    </div>

    <div class="footer" id="foot">此程序由奥特维王杰开发，请勿转发，如转发后果自负。</div>
  </div>

  <script>
    // ===  Cloudflare Workers 地址 ===
    const API_BASE = 'https://atwjerry.834833904.workers.dev'; 
    // 如果你的接口路径是 /pw，请把下面这行改为 '/pw'；否则留空字符串
    const API_PATH = ''; // 或者 '/pw'

    // ===== 多语言文本（🧳切换）=====
    const i18n = {
      zh: {
        title: "ATW串焊机4级解锁",
        placeholder: "请输入5位序列号",
        gen: "生成密码",
        resultPrefix: "密码是：",
        errNaN: "请输入 5 位纯数字序列号。",
        errSvc: "服务暂时不可用，请稍后再试。",
        footer: "此程序由奥特维王杰开发，请勿转发，如转发后果自负。",
        luggage: "🧳 Luggage"
      },
      en: {
        title: "ATW Tab Welding L4 Unlock",
        placeholder: "Enter 5-digit serial number",
        gen: "Generate Password",
        resultPrefix: "Password: ",
        errNaN: "Please enter a 5-digit numeric serial.",
        errSvc: "Service unavailable. Please try again later.",
        footer: "Developed by ATW Jerry. Do not redistribute; you assume all risks.",
        luggage: "🧳 Luggage"
      }
    };
    let lang = 'zh';

    function applyI18n(){
      const t = i18n[lang];
      document.getElementById('title').textContent = t.title;
      document.getElementById('sn').placeholder = t.placeholder;
      document.getElementById('genBtn').textContent = t.gen;
      document.getElementById('foot').textContent = t.footer;
      document.getElementById('luggageBtn').textContent = t.luggage;
      const resEl = document.getElementById('res');
      if (resEl.dataset.pwd) resEl.textContent = t.resultPrefix + resEl.dataset.pwd;
      document.documentElement.lang = (lang === 'zh' ? 'zh-CN' : 'en');
    }

    // ===== 顶部时间（本地时间）=====
    const nowEl = document.getElementById('now');
    function pad(n){ return String(n).padStart(2,'0'); }
    function tick() {
      const d = new Date();
      nowEl.textContent = `${d.getFullYear()}/${pad(d.getMonth()+1)}/${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
    }
    setInterval(tick, 1000); tick();

    // ===== 交互 =====
    const snEl = document.getElementById('sn');
    const resEl = document.getElementById('res');
    const errEl = document.getElementById('err');

    // 仅允许数字 & 最多5位
    snEl.addEventListener('input', e => {
      e.target.value = e.target.value.replace(/\D/g,'').slice(0,5);
    });
    snEl.addEventListener('keydown', e => { if (e.key === 'Enter') compute(); });

    document.getElementById('genBtn').addEventListener('click', compute);
    document.getElementById('luggageBtn').addEventListener('click', () => {
      lang = (lang === 'zh' ? 'en' : 'zh'); applyI18n();
    });

    async function compute(){
      const t = i18n[lang];
      const raw = (snEl.value || '').trim();
      errEl.textContent = ''; resEl.textContent = ''; resEl.dataset.pwd = '';

      if (!/^\d{5}$/.test(raw)){
        errEl.textContent = t.errNaN; return;
      }

      try{
        const base = API_BASE.replace(/\/+$/,''); // 去尾斜杠
        const path = API_PATH ? '/' + API_PATH.replace(/^\/+/,'') : '';
        const url  = `${base}${path}?sn=${raw}`;
        const r = await fetch(url, { cache:'no-store' });
        const data = await r.json();
        if (!r.ok || !data.pwd) throw new Error(data.error || 'bad');

        resEl.dataset.pwd = data.pwd;
        resEl.textContent = t.resultPrefix + data.pwd;
      }catch(e){
        errEl.textContent = t.errSvc;
        console.error(e);
      }
    }

    // 初始化语言
    applyI18n();
  </script>
</body>
</html>
