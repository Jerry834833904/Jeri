<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ATWä¸²ç„Šæœº4çº§è§£é”</title>
  <style>
    :root{
      --bg:#f5f5f7; --ink:#111; --muted:#8e8e93; --card:#fff;
      --border:#e5e5ea; --btnbg:#e9e9ec; --highlight:#16a34a;
    }
    html,body{height:100%;}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font:17px/1.7 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang SC","Microsoft YaHei",sans-serif;
    }
    .wrap{min-height:100%;display:flex;flex-direction:column;align-items:center;padding:env(safe-area-inset-top) 16px 40px}
    .topbar{width:100%;max-width:640px;display:flex;justify-content:space-between;align-items:center;margin-top:8px}
    #luggageBtn{border:1px solid var(--border); border-radius:10px; background:var(--btnbg); padding:8px 12px; cursor:pointer; font-size:15px;color:#007aff;}
    .card{
      width:100%; max-width:640px; background:var(--card); border:1px solid var(--border);
      border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.06); padding:24px 20px; margin-top:12px;
      text-align:center;
    }
    .title{font-weight:800; font-size:22px; margin:0 0 14px}
    .input-row{margin:14px auto 10px; width:min(460px,100%)}
    input[type="text"]{
      width:100%; border:1px solid var(--border); border-radius:12px; padding:12px 14px; outline:none; font-size:16px;
      background:#fff; text-align:center;
    }
    .btn-wide{
      width:min(460px,100%); border:1px solid var(--border); border-radius:12px; background:var(--btnbg);
      padding:14px 16px; cursor:pointer; font-size:16px; font-weight:700; margin:8px auto 0; display:block;color:#007aff;
    }
    .muted{color:var(--muted)}
    .result{font-size:20px; font-weight:700; color:var(--highlight); min-height:1.6em; margin-top:14px}
    .err{color:#e64d4d; min-height:1.2em; margin-top:8px}
    .footer{max-width:720px; color:#e64d4d; font-size:13px; text-align:center; margin-top:18px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div id="now" class="muted"></div>
      <div><button id="luggageBtn">ğŸ§³ Luggage</button></div>
    </div>

    <div class="card">
      <h1 class="title" id="title">ATWä¸²ç„Šæœº4çº§è§£é”</h1>

      <div class="input-row">
        <input id="sn" type="text" inputmode="numeric" autocomplete="off" placeholder="è¯·è¾“å…¥5ä½åºåˆ—å·" />
      </div>

      <button id="genBtn" class="btn-wide">ç”Ÿæˆå¯†ç </button>

      <div id="err" class="err"></div>
      <div id="res" class="result" data-raw-pwd=""></div>
    </div>

    <div id="foot" class="footer">æ­¤ç¨‹åºç”±å¥¥ç‰¹ç»´ç‹æ°å¼€å‘ï¼Œè¯·å‹¿è½¬å‘ï¼Œå¦‚è½¬å‘åæœè‡ªè´Ÿã€‚</div>
  </div>

  <script>
    // ====== åç«¯åŸŸå ======
    const API_BASE = "https://atwjerry.834833904.workers.dev";

    // ====== å¤šè¯­è¨€æ–‡æ¡ˆï¼ˆç•Œé¢æŒ‰æˆªå›¾å›ºå®šæ–‡æ¡ˆï¼›ä»å¯åˆ‡æ¢ï¼‰ ======
    const i18n = {
      zh: {
        title: "å¥¥ç‰¹ç»´ä¸²ç„Šæœº4çº§è§£é”",
        placeholder: "è¯·è¾“å…¥5ä½åºåˆ—å·",
        gen: "ç”Ÿæˆå¯†ç ",
        resultPrefix: "å¯†ç æ˜¯ï¼š",
        errNaN: "åºåˆ—å·å¿…é¡»æ˜¯5ä½æ•°å­—",
        errRange: "åºåˆ—å·èŒƒå›´ä¸º 00000 - 99999",
        luggage: "ğŸ§³ Luggage",
        footer: "æ­¤ç¨‹åºç”±å¥¥ç‰¹ç»´ç‹æ°å¼€å‘ï¼Œè¯·å‹¿è½¬å‘ï¼Œå¦‚è½¬å‘åæœè‡ªè´Ÿã€‚"
      },
      en: {
        title: "ATW Stringer L4 Unlock",
        placeholder: "Enter 5-digit serial number",
        gen: "Generate Password",
        resultPrefix: "Password: ",
        errNaN: "Serial number must be exactly 5 digits",
        errRange: "Valid range: 00000 - 99999",
        luggage: "ğŸ§³ Luggage",
        footer: "Developed by ATW Jerry. Do not forward; you assume all consequences."
      }
    };
    let lang = "zh";

    function applyI18n() {
      const t = i18n[lang];
      title.textContent = t.title;
      sn.placeholder = t.placeholder;
      genBtn.textContent = t.gen;
      foot.textContent = t.footer;
      luggageBtn.textContent = t.luggage;
      if (res.dataset.rawPwd) res.textContent = t.resultPrefix + res.dataset.rawPwd;
      document.documentElement.lang = (lang === 'zh' ? 'zh-CN' : 'en');
    }

    // ===== é¡¶éƒ¨æ˜¾ç¤ºæœ¬åœ°æ—¥æœŸ+æ—¶é—´ï¼ˆä¸æˆªå›¾æ ¼å¼ä¸€è‡´ï¼‰ =====
    const nowEl = document.getElementById('now');
    function pad(n){ return String(n).padStart(2,'0'); }
    function tickLocal() {
      const d = new Date();
      nowEl.textContent =
        `${d.getFullYear()}/${pad(d.getMonth()+1)}/${pad(d.getDate())} `
        + `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
    }
    setInterval(tickLocal, 1000); tickLocal();

    // ===== ä¸åç«¯å¯¹æ¥ä¿æŒä¸å˜ï¼šPOST /api/calc =====
    async function compute(){
      err.textContent = '';
      const t = i18n[lang];
      const raw = (sn.value || '').trim();

      if (!/^\d{5}$/.test(raw)){
        err.textContent = t.errNaN;
        res.textContent = '';
        res.dataset.rawPwd = '';
        return;
      }

      const n = Number(raw);
      if (n < 0 || n > 99999){
        err.textContent = t.errRange;
        res.textContent = '';
        res.dataset.rawPwd = '';
        return;
      }

      try {
        const clientEpochMs = Date.now();
        const tzOffsetMin = new Date().getTimezoneOffset();
        const r = await fetch(`${API_BASE}/api/calc`, {
          method: "POST",
          headers: { "content-type": "application/json" },
          body: JSON.stringify({ sn: raw, clientEpochMs, tzOffsetMin })
        });
        const data = await r.json();
        if (!r.ok) throw new Error(data?.error || ("HTTP " + r.status));
        res.dataset.rawPwd = data.pwd;
        res.textContent = t.resultPrefix + data.pwd;
      } catch (e) {
        err.textContent = (lang === 'zh' ? "è¯·æ±‚å¤±è´¥ï¼š" : "Request failed: ") + (e?.message || e);
        res.dataset.rawPwd = '';
        res.textContent = '';
      }
    }

    // äº‹ä»¶ç»‘å®šï¼ˆä¸åŸäº¤äº’ä¸€è‡´ï¼‰
    genBtn.addEventListener('click', compute);
    sn.addEventListener('keydown', e => { if (e.key === 'Enter') compute(); });
    sn.addEventListener('input', e => { e.target.value = e.target.value.replace(/\D/g, '').slice(0,5); });
    luggageBtn.addEventListener('click', () => { lang = (lang === 'zh' ? 'en' : 'zh'); applyI18n(); });

    applyI18n();
  </script>
</body>
</html>
